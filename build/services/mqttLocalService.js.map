{
  "version": 3,
  "sources": ["../../src/services/mqttLocalService.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/indent */\r\nimport mqtt from \"mqtt\";\r\nimport { ZendureSolarflow } from \"../main\";\r\nimport {\r\n  adapter,\r\n  initAdapter,\r\n  onConnected,\r\n  onError,\r\n  onMessage,\r\n} from \"./mqttSharedService\";\r\nimport {\r\n  startCalculationJob,\r\n  startCheckStatesAndConnectionJob,\r\n  startResetValuesJob,\r\n} from \"./jobSchedule\";\r\n\r\nexport const connectLocalMqttClient = (_adapter: ZendureSolarflow): void => {\r\n  initAdapter(_adapter);\r\n\r\n  if (!adapter) {\r\n    return;\r\n  }\r\n\r\n  const options: mqtt.IClientOptions = {\r\n    clientId: \"ioBroker.zendure-solarflow.\" + adapter.instance,\r\n  };\r\n\r\n  if (mqtt && adapter && adapter.config && adapter.config.localMqttUrl) {\r\n    adapter.log.debug(\r\n      `[connectLocalMqttClient] Connecting to MQTT broker ${\r\n        adapter.config.localMqttUrl + \":\" + 1883\r\n      }...`\r\n    );\r\n    adapter.mqttClient = mqtt.connect(\r\n      \"mqtt://\" + adapter.config.localMqttUrl + \":\" + 1883,\r\n      options\r\n    ); // create a client\r\n\r\n    if (adapter && adapter.mqttClient) {\r\n      adapter.mqttClient.on(\"connect\", onConnected);\r\n      adapter.mqttClient.on(\"error\", onError);\r\n\r\n      adapter.setState(\"info.connection\", true, true);\r\n\r\n      adapter.mqttClient.on(\"message\", onMessage);\r\n\r\n      // Job starten die states in der Nacht zu resetten\r\n      startResetValuesJob(adapter);\r\n\r\n      // Job starten die States zu checken\r\n      startCheckStatesAndConnectionJob(adapter);\r\n\r\n      // Calculation Job starten sofern aktiviert\r\n      if (adapter.config.useCalculation) {\r\n        startCalculationJob(adapter);\r\n      }\r\n    }\r\n  }\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,kBAAiB;AAEjB,+BAMO;AACP,yBAIO;AAEA,MAAM,yBAAyB,CAAC,aAAqC;AAC1E,4CAAY,QAAQ;AAEpB,MAAI,CAAC,kCAAS;AACZ;AAAA,EACF;AAEA,QAAM,UAA+B;AAAA,IACnC,UAAU,gCAAgC,iCAAQ;AAAA,EACpD;AAEA,MAAI,YAAAA,WAAQ,oCAAW,iCAAQ,UAAU,iCAAQ,OAAO,cAAc;AACpE,qCAAQ,IAAI;AAAA,MACV,sDACE,iCAAQ,OAAO,eAAe,OAChC;AAAA,IACF;AACA,qCAAQ,aAAa,YAAAA,QAAK;AAAA,MACxB,YAAY,iCAAQ,OAAO,eAAe;AAAA,MAC1C;AAAA,IACF;AAEA,QAAI,oCAAW,iCAAQ,YAAY;AACjC,uCAAQ,WAAW,GAAG,WAAW,oCAAW;AAC5C,uCAAQ,WAAW,GAAG,SAAS,gCAAO;AAEtC,uCAAQ,SAAS,mBAAmB,MAAM,IAAI;AAE9C,uCAAQ,WAAW,GAAG,WAAW,kCAAS;AAG1C,kDAAoB,gCAAO;AAG3B,+DAAiC,gCAAO;AAGxC,UAAI,iCAAQ,OAAO,gBAAgB;AACjC,oDAAoB,gCAAO;AAAA,MAC7B;AAAA,IACF;AAAA,EACF;AACF;",
  "names": ["mqtt"]
}
