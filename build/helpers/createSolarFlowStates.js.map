{
  "version": 3,
  "sources": ["../../src/helpers/createSolarFlowStates.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/indent */\r\n\r\nimport { ac2400States } from \"../constants/ac2400States\";\r\nimport { aceStates } from \"../constants/aceStates\";\r\nimport { aioStates } from \"../constants/aioStates\";\r\nimport { hubStates } from \"../constants/hubStates\";\r\nimport { hyperStates } from \"../constants/hyperStates\";\r\nimport { solarflow800ProStates } from \"../constants/solarflow800ProStates\";\r\nimport { solarflow800States } from \"../constants/solarflow800States\";\r\nimport { ZendureSolarflow } from \"../main\";\r\nimport { ISolarFlowDeviceDetails } from \"../models/ISolarFlowDeviceDetails\";\r\nimport { ISolarflowState } from \"../models/ISolarflowState\";\r\nimport { updateSolarFlowState } from \"../services/adapterService\";\r\nimport { createCalculationStates } from \"./createCalculationStates\";\r\nimport { createControlStates } from \"./createControlStates\";\r\nimport { getProductNameFromProductKey } from \"./helpers\";\r\n//import { deleteCalculationStates } from \"./deleteCalculationStates\";\r\n\r\nexport const getStateDefinition = (productName: string): ISolarflowState[] => {\r\n  switch (productName.toLocaleLowerCase()) {\r\n    case \"hyper 2000\":\r\n      return hyperStates;\r\n    case \"solarflow 800\":\r\n      return solarflow800States;\r\n    case \"solarflow2.0\":\r\n      return hubStates;\r\n    case \"solarflow hub 2000\":\r\n      return hubStates;\r\n    case \"solarflow aio zy\":\r\n      return aioStates;\r\n    case \"ace 1500\":\r\n      return aceStates;\r\n    case \"solarflow 800 pro\":\r\n      return solarflow800ProStates;\r\n    case \"solarflow 2400 ac\":\r\n      return ac2400States;\r\n    default:\r\n      return [];\r\n  }\r\n};\r\n\r\nexport const createSolarFlowStates = async (\r\n  adapter: ZendureSolarflow,\r\n  device: ISolarFlowDeviceDetails\r\n): Promise<void> => {\r\n  const productKey = device.productKey.replace(adapter.FORBIDDEN_CHARS, \"\");\r\n  const deviceKey = device.deviceKey.replace(adapter.FORBIDDEN_CHARS, \"\");\r\n  const productName = getProductNameFromProductKey(productKey);\r\n\r\n  if (\r\n    device.productKey ==\r\n    \"s3Xk4x\" /*  && adapter && adapter.userId && device.id */\r\n  ) {\r\n    adapter.log.debug(`[createSolarFlowStates] Smart Plug not supported.`);\r\n    return;\r\n    // productKey = adapter.userId;\r\n    // deviceKey = device.id.toString();\r\n  }\r\n\r\n  adapter.log.debug(\r\n    `[createSolarFlowStates] Creating or updating SolarFlow states for ${device.productName} (${productKey}/${deviceKey}) and name '${device.name}'.`\r\n  );\r\n\r\n  // Create device (e.g. the product type -> SolarFlow)\r\n  await adapter?.extendObject(productKey, {\r\n    type: \"device\",\r\n    common: {\r\n      name: {\r\n        de: `${device.productName} (${productKey})`,\r\n        en: `${device.productName} (${productKey})`,\r\n      },\r\n    },\r\n    native: {},\r\n  });\r\n\r\n  // Create channel (e.g. the device specific key)\r\n  await adapter?.extendObject(productKey + \".\" + deviceKey, {\r\n    type: \"channel\",\r\n    common: {\r\n      name: {\r\n        de: `${device.name} (${deviceKey})`,\r\n        en: `${device.name} (${deviceKey})`,\r\n      },\r\n    },\r\n    native: {},\r\n  });\r\n\r\n  // Create pack data folder\r\n  if (!device.productName.toLocaleLowerCase().includes(\"smart plug\")) {\r\n    await adapter?.extendObject(`${productKey}.${deviceKey}.packData`, {\r\n      type: \"channel\",\r\n      common: {\r\n        name: {\r\n          de: \"Batterie Packs\",\r\n          en: \"Battery packs\",\r\n        },\r\n      },\r\n      native: {},\r\n    });\r\n  }\r\n\r\n  const states = getStateDefinition(productName);\r\n\r\n  if (states.length == 0) {\r\n    adapter.log.error(\r\n      `[createSolarFlowLocalStates] Unknown product (${device.productKey}/'${device.productName}'). We cannot create control states! Please contact the developer!`\r\n    );\r\n    return;\r\n  }\r\n\r\n  states.forEach(async (state: ISolarflowState) => {\r\n    await adapter?.extendObject(`${productKey}.${deviceKey}.${state.title}`, {\r\n      type: \"state\",\r\n      common: {\r\n        name: {\r\n          de: state.nameDe,\r\n          en: state.nameEn,\r\n        },\r\n        type: state.type,\r\n        desc: state.title,\r\n        role: state.role,\r\n        read: true,\r\n        write: false,\r\n        unit: state.unit,\r\n        states: state.states,\r\n      },\r\n      native: {},\r\n    });\r\n  });\r\n\r\n  // Set SOC from device\r\n  if (\r\n    device.electricity &&\r\n    !device.productName.toLocaleLowerCase().includes(\"smart plug\")\r\n  ) {\r\n    await updateSolarFlowState(\r\n      adapter,\r\n      device.productKey,\r\n      device.deviceKey,\r\n      \"electricLevel\",\r\n      device.electricity\r\n    );\r\n  }\r\n\r\n  // Set sn number from device\r\n  if (device.snNumber) {\r\n    await updateSolarFlowState(\r\n      adapter,\r\n      productKey,\r\n      deviceKey,\r\n      \"snNumber\",\r\n      device.snNumber.toString()\r\n    );\r\n  }\r\n\r\n  // Set the ACE connection info if is solarflow hub device\r\n  if (\r\n    (device.productName.toLocaleLowerCase() == \"solarflow hub 2000\" ||\r\n      device.productName.toLocaleLowerCase() == \"solarflow2.0\") &&\r\n    device._connectedWithAce != null &&\r\n    device._connectedWithAce != undefined\r\n  ) {\r\n    await updateSolarFlowState(\r\n      adapter,\r\n      device.productKey,\r\n      device.deviceKey,\r\n      \"connectedWithAce\",\r\n      device._connectedWithAce\r\n    );\r\n  }\r\n\r\n  // Set product name from device\r\n  await updateSolarFlowState(\r\n    adapter,\r\n    productKey,\r\n    deviceKey,\r\n    \"productName\",\r\n    device.productName\r\n  );\r\n\r\n  // Set wifi state from device\r\n  await updateSolarFlowState(\r\n    adapter,\r\n    productKey,\r\n    deviceKey,\r\n    \"wifiState\",\r\n    device.wifiStatus ? \"Connected\" : \"Disconnected\"\r\n  );\r\n\r\n  if (!device.productName.toLocaleLowerCase().includes(\"smart plug\")) {\r\n    // Create control states only when using App MQTT servers - and not the fallback one!\r\n    if (!adapter.config.useFallbackService) {\r\n      await createControlStates(adapter, productKey, deviceKey, productName);\r\n    }\r\n\r\n    if (adapter.config.useCalculation) {\r\n      // Create calculations folder\r\n      await adapter?.extendObject(`${productKey}.${deviceKey}.calculations`, {\r\n        type: \"channel\",\r\n        common: {\r\n          name: {\r\n            de: \"Berechnungen f\u00FCr Ger\u00E4t \" + deviceKey,\r\n            en: \"Calculations for Device \" + deviceKey,\r\n          },\r\n        },\r\n        native: {},\r\n      });\r\n\r\n      await createCalculationStates(adapter, productKey, deviceKey);\r\n    } else {\r\n      //await deleteCalculationStates(adapter, productKey, deviceKey);\r\n    }\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
